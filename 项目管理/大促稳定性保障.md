### 大促稳定性保障

#### (1). 监控篇

购物车监控地址：https://gz.ops.yangege.cn/d/OX7sHLIZz/gou-wu-che?orgId=1

促销监控地址：https://gz.ops.yangege.cn/d/C7jvutIZz/ying-xiao-jian-kong-da-pan?orgId=1





#### (2). 应急篇

##### 提前预案

> **1). 限流购物车数量**
>
> 接口名称：/cart/api/cart/count
>
> 功能作用：首页，详情页，购物车底部Tab栏【所有展示购物车数量】
>
> 限流时间：默认一直开启。
>
> 限流大小：20000QPS
>
> 限流原因：目前购物车count接口直接读交易买家数据库【trade-buyer】，正向下单也是使用这个库，如果流量无限放开的话，可能会导致影响下单功能。
>
> 限流影响：影响购物车数量展示，资源位不展示数量值【返回数量0】，业务影响较小。
>
> 
>
> **2). 降级购物车列表优惠信息透出**
>
> 接口名称：/cart/api/cart/v2/show
>
> 功能作用：购物车列表展示和优惠信息透出。
>
> 执行开关地址：http://sentry.ops.yangege.cn/guarder/list【PROMOTION设置为降级】
>
> 执行时间：当促销大量限流异常，手动触发降级。
>
> 恢复时间：峰值流量过后，手动恢复。
>
> 降级原因：促销目前支持的QPS【2400】，如果大促期间购物车流量过大，可能会影响下单业务【促销资源有限】。所以需要降级
>
> 降级影响：购物车优惠信息不透出，下单结算页透出的价格可能和购物车不一致。

说明：购物车本身设置限流6000，如果促销那边发生了限流或者超时异常。购物车能正常处理请求，只是促销限流的部分没有促销信息。



##### 应急预案

降级地址：http://sentry.pre-ops.yangege.cn/guarder/list

| 预案           | 动作                             | 降级开关变量                 | 影响范围                     |
| :------------- | :------------------------------- | :--------------------------- | :--------------------------- |
| 促销服务       | 降级【促销限流，自动触发】       | CartDemotionNameIF.PROMOTION | 购物车列表不展示促销信息     |
| 发货地报关服务 | 降级【报关服务压挂了，手动触发】 | DELIVERID_CUSTOMS            | 购物车列表不展示海关税费信息 |

**ps：**购物车强依赖商品服务，用户服务和店铺服务。他们服务如果不可能，那么购物车列表将完全不可用哦。

